<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" id="meta-viewport" />
  <title>KzFlix Filmes & Séries</title>
  <link rel="icon" href="imagens/Kz Logo.webp" type="image/png" />
  <style>
    * { box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #eee;
      margin: 0;
      padding: 15px 20px 20px 20px;
    }

    body.modal-aberto {
      overflow: hidden !important;
      touch-action: none !important;
      overscroll-behavior: contain !important;
      position: fixed;
      width: 100vw;
    }

    header {
      position: relative;
      padding-bottom: 10px;
      margin-bottom: 10px;
    }

    .titulo-centralizado {
      text-align: center;
    }

    .campo-busca {
      position: absolute;
      top: 0;
      right: 0;
      width: 280px;
    }

    #busca {
      width: 100%;
      padding: 12px 40px 12px 40px;
      font-size: 16px;
      border-radius: 30px;
      border: none;
      background-color: #333;
      color: #fff;
      transition: all 0.3s;
      outline: none;
      position: relative;
      z-index: 1000;
    }

    #busca::placeholder {
      color: #aaa;
    }

    .campo-busca::before {
      position: absolute;
      top: 14px;
      left: 15px;
      font-size: 18px;
      color: #aaa;
      pointer-events: none;
      user-select: none;
    }

    .lista-generos {
      position: absolute;
      top: 42px;
      right: 0;
      background: #222;
      border-radius: 0 0 8px 8px;
      width: 100%;
      max-height: 160px;
      overflow-y: auto;
      padding: 0;
      margin: 0;
      list-style: none;
      z-index: 21000;
      box-shadow: 0 4px 8px rgba(0,0,0,0.6);
      display: none;
    }

    .lista-generos li {
      padding: 10px 15px;
      cursor: pointer;
      color: #eee;
      border-bottom: 1px solid #444;
      transition: background 0.2s;
    }

    .lista-generos li:hover,
    .lista-generos li:focus {
      background: #1db954;
      color: #fff;
      outline: none;
    }

    .filtros {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      margin-bottom: 15px;
    }

    .filtros button {
      background: #282828;
      border: none;
      color: #eee;
      padding: 10px 20px;
      margin: 0 5px 5px 0;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
      transition: background 0.3s;
    }

    .filtros button:hover,
    .filtros button.active {
      background: #1db954;
      color: #fff;
    }

    .lista {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 20px;
    }

    .card {
      background: #222;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.7);
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      min-width: 0;
      outline: none;
      touch-action: manipulation;
      /* Aumenta área de toque para mobile */
      margin-bottom: 8px;
      border: 2px solid transparent;
    }
    .card:focus-visible {
      border: 2px solid #1db954;
      box-shadow: 0 0 0 3px #1db95455, 0 2px 8px rgba(0,0,0,0.7);
      outline: none;
    }
    @media (max-width: 600px) {
      .card {
        border-radius: 16px;
        min-width: 140px;
        max-width: 100vw;
        margin-bottom: 14px;
        box-shadow: 0 1px 4px #0006;
      }
      .card img {
        height: 160px;
        border-radius: 16px 16px 0 0;
      }
      .card-body {
        padding: 10px 8px 12px 8px;
      }
      .card-title {
        font-size: 1.08rem;
        margin-bottom: 6px;
      }
      .card-desc {
        font-size: 13px;
        max-height: 38px;
        padding-right: 0;
      }
    }

    .card:hover {
      transform: scale(1.05);
    }

    .card img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .card-body {
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card-title {
      font-size: 18px;
      margin: 0 0 10px;
      font-weight: bold;
      color: #fff;
      line-height: 1.2;
      word-break: break-word;
    }

    .card-desc {
      font-size: 14px;
      color: #ccc;
      line-height: 1.4;
      max-height: 60px;
      overflow-y: auto;
      white-space: normal;
      text-overflow: unset;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: #888 #222;
      outline: none;
    }
    .card-desc::-webkit-scrollbar {
      width: 6px;
      background: #222;
    }
    .card-desc::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    .assistir-btn, .continuar-btn, #btn-salvar-ponto, #btn-limpar-historico, .fullscreen-player, .fechar-player, .pular-capitulo-player-global, .menu-btn {
      background: linear-gradient(90deg, #1db954 0%, #17a944 100%);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 24px;
      cursor: pointer;
      font-size: 1rem;
      font-family: 'Segoe UI', Arial, sans-serif;
      font-weight: 500;
      box-shadow: 0 1px 6px #1db95433, 0 1px 2px #0001;
      transition: background 0.22s, box-shadow 0.22s, transform 0.14s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      outline: none;
      min-width: 44px;
      min-height: 44px;
      line-height: 1.2;
      touch-action: manipulation;
    }
    .assistir-btn:focus-visible, .continuar-btn:focus-visible {
      outline: 2px solid #1db954;
      outline-offset: 2px;
      box-shadow: 0 0 0 3px #1db95455;
    }
    .assistir-btn.trailer, .vitrine-botoes button.trailer {
      background: linear-gradient(90deg, #555 0%, #444 100%);
      color: #fff;
      margin-left: 10px;
      box-shadow: 0 2px 12px #4444, 0 1px 4px #0002;
      min-width: 44px;
      min-height: 44px;
    }
    .assistir-btn:hover, .continuar-btn:hover, #btn-salvar-ponto:hover, #btn-limpar-historico:hover, .fullscreen-player:hover, .fechar-player:hover, .pular-capitulo-player-global:hover, .menu-btn:hover {
      background: linear-gradient(90deg, #17a944 0%, #1db954 100%);
      box-shadow: 0 4px 18px #1db95466, 0 2px 8px #0003;
      transform: scale(1.04);
    }
    @media (max-width: 600px) {
      .assistir-btn, .continuar-btn {
        font-size: 1.08rem;
        padding: 12px 0;
        border-radius: 20px;
        width: 100%;
        min-width: 0;
        min-height: 44px;
        margin-top: 6px;
        margin-bottom: 2px;
        justify-content: center;
      }
    }
    .assistir-btn.trailer:hover, .vitrine-botoes button.trailer:hover {
      background: linear-gradient(90deg, #444 0%, #555 100%);
      box-shadow: 0 4px 18px #4446, 0 2px 8px #0003;
      transform: scale(1.04);
    }
    .continuar-btn {
      background: linear-gradient(90deg, #1db9e0 0%, #1db954 100%);
      color: #fff;
      font-size: 1rem;
      padding: 10px 22px;
      border-radius: 32px;
      box-shadow: 0 2px 12px #1db9e044, 0 1px 4px #0002;
      text-align: center;
      justify-content: center;
      align-items: center;
      display: flex;
    }
    .continuar-btn:hover {
      background: linear-gradient(90deg, #17a9e0 0%, #1db954 100%);
      box-shadow: 0 4px 18px #1db9e066, 0 2px 8px #0003;
      transform: scale(1.04);
    }
    #btn-salvar-ponto {
      font-size: 1rem;
      padding: 10px 22px;
      border-radius: 32px;
      background: linear-gradient(90deg, #1db954 0%, #1db9e0 100%);
      box-shadow: 0 2px 12px #1db95444, 0 1px 4px #0002;
    }
    #btn-salvar-ponto:hover {
      background: linear-gradient(90deg, #17a944 0%, #1db9e0 100%);
      box-shadow: 0 4px 18px #1db95466, 0 2px 8px #0003;
      transform: scale(1.04);
    }
    #btn-limpar-historico {
      background: linear-gradient(90deg, #e50914 0%, #ff3c3c 100%);
      color: #fff;
      font-size: 1rem;
      padding: 10px 22px;
      border-radius: 32px;
      box-shadow: 0 2px 12px #e5091444, 0 1px 4px #0002;
      font-weight: 600;
    }
    #btn-limpar-historico:hover {
      background: linear-gradient(90deg, #ff3c3c 0%, #e50914 100%);
      box-shadow: 0 4px 18px #e5091466, 0 2px 8px #0003;
      transform: scale(1.04);
    }
    .fullscreen-player, .fechar-player {
      font-size: 1.2rem;
      padding: 10px 18px;
      border-radius: 32px;
      background: linear-gradient(90deg, #222 0%, #1db954 100%);
      color: #fff;
      box-shadow: 0 2px 12px #2224, 0 1px 4px #0002;
    }
    .fullscreen-player:hover, .fechar-player:hover {
      background: linear-gradient(90deg, #1db954 0%, #222 100%);
      box-shadow: 0 4px 18px #1db95466, 0 2px 8px #0003;
      transform: scale(1.08);
    }
    .pular-capitulo-player-global {
      font-size: 1.08rem;
      padding: 12px 32px;
      border-radius: 40px;
      background: linear-gradient(270deg, #1db954 0%, #1db9e0 50%, #17a944 100%);
      color: #fff;
      box-shadow: 0 4px 24px #1db95488, 0 2px 8px #0003;
      font-weight: 700;
      letter-spacing: 0.5px;
      border: 2px solid #fff2;
      position: absolute;
      right: 18px;
      bottom: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: background 0.3s, box-shadow 0.3s, transform 0.18s;
      animation: pulse-gradient 2.5s infinite linear;
    }
    .pular-capitulo-player-global:hover {
      background: linear-gradient(90deg, #1db9e0 0%, #1db954 50%, #17a944 100%);
      box-shadow: 0 8px 32px #1db954cc, 0 4px 16px #0004;
      transform: scale(1.08);
      border-color: #1db95488;
    }
    @keyframes pulse-gradient {
      0% { box-shadow: 0 4px 24px #1db95488, 0 2px 8px #0003; }
      50% { box-shadow: 0 8px 32px #1db954cc, 0 4px 16px #0004; }
      100% { box-shadow: 0 4px 24px #1db95488, 0 2px 8px #0003; }
    }
    .menu-btn {
      background: linear-gradient(90deg, #222 0%, #1db954 100%);
      color: #fff;
      font-size: 1rem;
      padding: 10px 0;
      border-radius: 32px;
      box-shadow: 0 2px 12px #2224, 0 1px 4px #0002;
      font-weight: 600;
      width: 180px;
      min-width: 180px;
      max-width: 180px;
      min-height: 44px;
      text-align: center;
      margin: 0 auto 10px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.22s, box-shadow 0.22s, transform 0.14s;
    }
    .menu-btn:hover {
      background: linear-gradient(90deg, #1db954 0%, #222 100%);
      box-shadow: 0 4px 18px #1db95466, 0 2px 8px #0003;
      transform: scale(1.08);
    }

    #modal-episodios {
      position: fixed;
      top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(18, 24, 32, 0.82);
      backdrop-filter: blur(8px) saturate(1.2);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      padding: 0;
      overflow: auto;
      animation: modalFadeIn 0.5s cubic-bezier(.4,1.4,.6,1) 1;
    }

    #modal-episodios .modal-conteudo {
      background: linear-gradient(135deg, rgba(34,34,44,0.98) 60%, rgba(29,185,84,0.12) 100%);
      border-radius: 28px;
      padding: 36px 32px 28px 32px;
      width: 100%;
      max-width: 420px;
      color: #f2f2f2;
      box-shadow: 0 8px 40px #000a, 0 2px 12px #1db95433;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: modalPopIn 0.6s cubic-bezier(.4,1.4,.6,1) 1;
    }
    @keyframes modalFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes modalPopIn {
      0% { transform: scale(0.92) translateY(40px); opacity: 0; }
      80% { transform: scale(1.04) translateY(-8px); opacity: 1; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    #modal-episodios h2 {
      margin-top: 0;
      margin-bottom: 15px;
      text-align: center;
    }

    #modal-episodios select,
    #modal-episodios button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    #modal-episodios select {
      background: #121212;
      color: #eee;
    }

    #modal-episodios button {
      background: #1db954;
      color: white;
    }

    #modal-episodios button:hover {
      background: #17a944;
    }

    #modal-episodios button#btn-fechar-modal {
      background: #e50914;
      margin-top: 10px;
    }

    #modal-player {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(18, 24, 32, 0.88);
      backdrop-filter: blur(10px) saturate(1.2);
      justify-content: center;
      align-items: center;
      z-index: 10001;
      transition: opacity 0.3s ease;
      padding: 0;
      overflow: auto;
      animation: modalFadeIn 0.5s cubic-bezier(.4,1.4,.6,1) 1;
    }

    #modal-player.show {
      display: flex;
      opacity: 1;
    }

    #modal-player > div {
      position: relative;
      width: 100%;
      max-width: 760px;
      max-height: 62vh;
      aspect-ratio: 16 / 9;
      background: linear-gradient(135deg, #18181c 80%, #1db95422 100%);
      border-radius: 28px;
      overflow: hidden;
      box-shadow: 0 8px 40px #000a, 0 2px 12px #1db95433;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: modalPopIn 0.6s cubic-bezier(.4,1.4,.6,1) 1;
    }

    #modal-player .fechar-player {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(229, 9, 20, 0.9);
      border: none;
      color: #fff;
      font-size: 20px;
      padding: 8px 12px;
      border-radius: 50px;
      cursor: pointer;
      z-index: 10;
      transition: background 0.3s ease;
    }

    #modal-player .fechar-player:hover {
      background: rgba(229, 9, 20, 1);
    }

    #modal-player .pular-capitulo-player {
      position: absolute;
      bottom: 18px;
      right: 18px;
      background: #1db954;
      border: none;
      color: #fff;
      font-size: 16px;
      padding: 10px 22px;
      border-radius: 30px;
      cursor: pointer;
      z-index: 12;
      transition: background 0.3s;
      display: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    #modal-player .pular-capitulo-player:hover {
      background: #17a944;
    }

    #iframe-player {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    @media (max-width: 600px) {
      .campo-busca {
        position: static;
        width: 100%;
        margin-bottom: 15px;
      }
      .lista {
        grid-template-columns: repeat(2, 1fr);
      }
      .card img {
        height: 240px;
      }
      #busca {
        padding-left: 35px;
      }

      .lista-generos {
        position: static;
        max-height: none;
        width: 100%;
        border-radius: 8px;
        margin-top: 5px;
      }
      .titulo-centralizado h1 {
      font-size: 22px;
      line-height: 1.2;
      margin-top: 10px;
      }
      .perfil-container {
        top: 10px;
        left: 10px;
      }
      .vitrine-card {
      width: 160px;
      }
      }

      .perfil-container {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 10000;
      }

      #btn-perfil {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        position: relative;
        z-index: 10000;
      }

      .menu-perfil {
        display: none;
        position: absolute;
        top: 40px;
        left: 0;
        background: #222;
        border-radius: 8px;
        list-style: none;
        margin: 0;
        padding: 10px 0;
        box-shadow: 0 4px 8px rgba(0,0,0,0.6);
        min-width: 160px;
        z-index: 99999 !important;
      }
      #toggle-dark {
        position: relative;
        z-index: 30000;
      }

      .menu-perfil li {
        padding: 10px 15px;
        color: #eee;
        cursor: pointer;
        transition: background 0.2s;
      }

      .menu-perfil li:hover,
      .menu-perfil li:focus {
        background: #1db954;
        color: #fff;
      }
      body.modo-claro {
        background: #f2f2f2;
        color: #111;
      }

      body.modo-claro .card {
        background: #fff;
      }

      body.modo-claro .card-desc {
        color: #444;
      }

      body.modo-claro .assistir-btn {
        background: #1db954;
        color: white;
      }

      body.modo-claro .assistir-btn.trailer {
        background: #ccc;
        color: #000;
      }

      body.modo-claro .filtros button {
        background: #ddd;
        color: #111;
      }

      body.modo-claro .filtros button.active {
        background: #1db954;
        color: #fff;
      }

      body.modo-claro #busca {
        background: #ddd;
        color: #000;
      }

      body.modo-claro .lista-generos {
        background: #f2f2f2;
        color: #111;
      }

      body.modo-claro .menu-perfil {
        background: #fff;
        color: #000;
      }
      .kz-vermelho {
        color: #e50914;
      }

      .kz-texto {
        color: #fff;
      }

      body.modo-claro .kz-texto {
        color: #111;
      }
      .vitrine {
        display: flex;
        overflow-x: auto;
        gap: 15px;
        padding-bottom: 10px;
      }

      .vitrine::-webkit-scrollbar {
        height: 8px;
      }
      .vitrine::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 4px;
      }

      .vitrine-card {
        flex: 0 0 auto;
        width: 200px;
        background: #222;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.7);
      }

      .vitrine-card img {
        width: 100%;
        height: 260px;
        object-fit: cover;
      }

      .vitrine-card h3 {
        font-size: 16px;
        margin: 10px;
        color: #fff;
      }
      body.modo-claro .vitrine-card {
        background: #fff;
      }
      body.modo-claro .vitrine-card h3 {
        color: #000;
      }
      .secao-titulo {
        font-size: 24px;
        color: #fff;
        margin-bottom: 15px;
      }

      body.modo-claro .secao-titulo {
        color: #111;
      }

      .vitrine-scroll {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch;
        gap: 20px;
        padding-bottom: 10px;
        scroll-behavior: smooth;
        padding-left: 10px;
      }

      .vitrine-scroll::-webkit-scrollbar {
        height: 8px;
      }

      .vitrine-scroll::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 4px;
      }

      .vitrine-card {
        flex: 0 0 auto;
        width: 200px;
        scroll-snap-align: start;
        position: relative;
        background: #222;
        border-radius: 10px;
        overflow: hidden;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .vitrine-card:hover {
        transform: scale(1.05);
      }

      .vitrine-card img {
        width: 100%;
        height: 280px;
        object-fit: cover;
        display: block;
      }

      .vitrine-info {
        position: absolute;
        bottom: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        width: 100%;
        padding: 10px;
        color: #fff;
        text-shadow: 1px 1px 2px #000;
        transition: opacity 0.3s;
      }

      .vitrine-card:hover .vitrine-info {
        opacity: 1;
      }

      .vitrine-info h3 {
        font-size: 16px;
        margin: 0 0 5px;
      }

    .vitrine-botoes {
      display: flex;
      flex-direction: row;
      gap: 8px;
      margin-top: 8px;
      justify-content: center;
      align-items: center;
      width: 100%;
      flex-wrap: nowrap;
    }
    @media (max-width: 600px) {
      .vitrine-botoes {
        gap: 6px;
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        justify-content: space-between;
      }
      /* Ajuste apenas para os botões dos CARDS PRINCIPAIS (vitrine-lancamentos) */
      .vitrine-scroll#vitrine-lancamentos .vitrine-botoes button,
      .vitrine-scroll#vitrine-lancamentos .vitrine-botoes button.trailer {
        font-size: 1rem;
        padding: 12px 0;
        min-width: 110px;
        width: 100%;
        box-sizing: border-box;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        border-radius: 14px;
        min-height: 40px;
        margin-top: 6px;
        margin-bottom: 2px;
        justify-content: center;
        display: inline-flex;
        align-items: center;
        touch-action: manipulation;
      }
      .vitrine-scroll#vitrine-lancamentos .vitrine-botoes > * {
        flex: 1 1 0;
        max-width: 50%;
      }
    }

      .vitrine-botoes button {
        white-space: nowrap;
        min-width: 110px;
        flex: 1;
        font-size: 12px;
        background: #1db954;
        border: none;
        color: white;
        border-radius: 10px;
        font-size: 0.91rem;
        padding: 7px 0;
        width: 46%;
        min-width: 80px;
        min-height: 34px;
        margin-top: 4px;
        margin-bottom: 2px;
        justify-content: center;
        display: inline-flex;
        align-items: center;
        padding: 5px;
        cursor: pointer;
        transition: background 0.3s;
        outline: none;
      }

      .vitrine-botoes button.trailer {
        white-space: nowrap;
        min-width: 90px;
        background: #555;
        border-radius: 10px;
        font-size: 0.91rem;
        padding: 7px 0;
        width: 46%;
        min-width: 80px;
        min-height: 34px;
        margin-top: 4px;
        margin-bottom: 2px;
        justify-content: center;
        display: inline-flex;
        align-items: center;
        touch-action: manipulation;
      }

      .vitrine-botoes button:hover {
        background: #17a944;
      }

      .vitrine-botoes button.trailer:hover {
        background: #444;
    }
    .vitrine-botoes button:focus-visible {
        outline: 2px solid #1db954;
        outline-offset: 2px;
        box-shadow: 0 0 0 3px #1db95455;
    }
    @media (max-width: 600px) {
      .vitrine-botoes button,
      .vitrine-botoes button.trailer {
        font-size: 0.93rem;
        padding: 11px 0;
        min-width: 0;
        width: 48%;
        box-sizing: border-box;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .vitrine-botoes {
        gap: 4%;
        width: 100%;
        display: flex;
        flex-wrap: nowrap;
        justify-content: space-between;
      }
    }
      .vitrine-botoes {
        gap: 4%;
      }
      .continuar-btn {
        font-size: 0.97rem;
        padding: 7px 0;
        border-radius: 10px;
        width: 46%;
        min-width: 80px;
        min-height: 34px;
        margin-top: 4px;
        margin-bottom: 2px;
        justify-content: center;
        display: inline-flex;
        align-items: center;
        touch-action: manipulation;
        background: linear-gradient(90deg, #1db954 0%, #17a944 100%);
        color: #fff;
        border: none;
        box-shadow: 0 1px 6px #1db95433, 0 1px 2px #0001;
        transition: background 0.22s, box-shadow 0.22s, transform 0.14s;
        cursor: pointer;
        gap: 8px;
        outline: none;
    }
    .continuar-btn:focus-visible {
        outline: 2px solid #1db954;
        outline-offset: 2px;
        box-shadow: 0 0 0 3px #1db95455;
      }

      body.modo-claro .vitrine-card {
        background: #fff;
      }

      body.modo-claro .vitrine-info {
        color: #111;
        background: linear-gradient(to top, rgba(255,255,255,0.9), transparent);
      }

      body.modo-claro .vitrine-botoes button.trailer {
        background: #ccc;
        color: #000;
      }
    .ano-overlay {
      position: absolute;
      bottom: 6px;
      left: 8px;
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 1px 8px;
      font-size: 10px;
      border-radius: 4px;
      font-weight: bold;
      z-index: 1;
    }

    @media (max-width: 900px) {
  #modal-player.simulacao-fullscreen-mobile {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    min-width: 100vw !important;
    min-height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    padding: 0 !important;
    margin: 0 !important;
    background: #000 !important;
    z-index: 99999 !important;
    align-items: stretch !important;
    justify-content: center !important;
    display: flex !important;
    overflow: hidden !important;
  }
  #modal-player.simulacao-fullscreen-mobile > div {
    width: 100vw !important;
    height: 100vh !important;
    min-width: 100vw !important;
    min-height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    aspect-ratio: unset !important;
    background: #000 !important;
    position: relative !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }
  #modal-player.simulacao-fullscreen-mobile iframe {
    width: 100vw !important;
    height: 100vh !important;
    min-width: 100vw !important;
    min-height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    border-radius: 0 !important;
    background: #000 !important;
    display: block !important;
    margin: 0 !important;
    padding: 0 !important;
  }
}
  </style>
</head>
<body>
  <header>
    <!-- Botão de login removido, login obrigatório -->
    <div class="perfil-container">
      <button id="btn-perfil" aria-label="Abrir menu de perfil">⚙️</button>
      <ul id="menu-perfil" class="menu-perfil" role="menu" aria-label="Menu de Perfil">
        <li role="menuitem" tabindex="0" id="toggle-dark">🌙 Alternar Dark Mode</li>
      </ul>
    </div>

    <div class="titulo-centralizado">
      <h1>
        <span class="kz-vermelho">Kz</span>
        <span class="kz-texto">Flix Filmes & Séries</span>
      </h1>
      <p>Desfrute das melhores produções!</p>
    </div>

    <div class="campo-busca">
      <input type="text" id="busca" placeholder="🔎 Buscar por título ou gênero..." autocomplete="off" aria-label="Buscar por título ou gênero" />
      <ul id="lista-generos" class="lista-generos" role="listbox" tabindex="-1" aria-label="Lista de gêneros">
        <li data-genero="all" tabindex="0" role="option">Todos</li>
        <li data-genero="ação" tabindex="0" role="option">Ação</li>
        <li data-genero="aventura" tabindex="0" role="option">Aventura</li>
        <li data-genero="comédia" tabindex="0" role="option">Comédia</li>
        <li data-genero="drama" tabindex="0" role="option">Drama</li>
        <li data-genero="terror" tabindex="0" role="option">Terror</li>
        <li data-genero="ficção científica" tabindex="0" role="option">Ficção Científica</li>
        <li data-genero="fantasia" tabindex="0" role="option">Fantasia</li>
        <li data-genero="documentário" tabindex="0" role="option">Documentário</li>
        <li data-genero="animação" tabindex="0" role="option">Animação</li>
      </ul>
    </div>
  </header>
  <div class="filtros" role="group" aria-label="Filtros de tipo">
    <button class="active" data-type="all" aria-pressed="true">Todos</button>
    <button data-type="movie" aria-pressed="false">Filmes</button>
    <button data-type="series" aria-pressed="false">Séries</button>
    <button
      id="btn-home"
      style="margin-left: 10px; padding: 10px 20px; border: none; background: #e50914; color: white; border-radius: 5px; cursor: pointer; display: none;"
    >
      Sair da pesquisa
    </button>
  </div>
  <section id="lancamentos" style="margin: 40px 0;">
    <h2 class="secao-titulo">🔥 Adicionados Recentemente</h2>
    <div class="vitrine-scroll" id="vitrine-lancamentos">
      <!-- Os lançamentos serão inseridos aqui -->
    </div>
  </section>

  <!-- Cria a seção "Continuar Assistindo" abaixo dos lançamentos -->
  <section id="continuar-assistindo" style="margin: 40px 0; position: relative; background: linear-gradient(90deg,#181818 0%,#222 100%); border-radius: 18px; box-shadow: 0 4px 24px #0004; padding: 28px 18px 24px 18px;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px;">
      <h2 style="font-size:1.5rem; color:#fff; margin:0; font-weight:bold; letter-spacing:1px; text-shadow:0 2px 8px #0008;">⏳ Continuar Assistindo</h2>
      <button id="btn-limpar-historico" style="background:#e50914;color:#fff;border:none;padding:8px 18px;border-radius:24px;cursor:pointer;font-size:14px;display:none;box-shadow:0 2px 8px #0004;">🗑️ Limpar Histórico</button>
    </div>
    <div id="vitrine-continuar" class="vitrine-scroll" style="display:flex;gap:18px;overflow-x:auto;padding-bottom:8px;"></div>
  </section>
      <button id="btn-limpar-historico"
        style="display:none; background:#e50914; color:#fff; border:none; border-radius:7px; padding:8px 18px; font-size:14px; font-weight:bold; cursor:pointer; margin-left:16px;"
        title="Limpar histórico de continuar assistindo">
        🗑️ Limpar Histórico
      </button>
    </h2>
    
  </section>

  <main>
    <div class="lista" id="lista" aria-live="polite" aria-label="Lista de filmes e séries"></div>
    <button id="btn-carregar-mais" style="display:none; margin: 20px auto; padding: 12px 24px; font-size: 16px; border-radius: 6px; background: #1db954; color: white; border: none; cursor: pointer; display: block;">
    Carregar mais
    </button>

  </main>

  <!-- Modal Episódios -->
  <div id="modal-episodios" role="dialog" aria-modal="true" aria-labelledby="modal-titulo" tabindex="-1">
    <div class="modal-conteudo">
      <h2 id="modal-titulo"></h2>
      <label for="select-temporada">Selecione a temporada:</label>
      <select id="select-temporada" aria-label="Selecione a temporada"></select>
      <label for="select-episodio">Selecione o episódio:</label>
      <select id="select-episodio" aria-label="Selecione o episódio"></select>
      <button id="btn-assistir-episodio" aria-label="Assistir episódio selecionado">▶️ Assistir Episódio</button>
      <button id="btn-fechar-modal" style="background:#e50914; margin-top:10px;">❌ Fechar</button>
    </div>
  </div>

  <!-- Modal Login moderno -->
  <div id="modal-login" style="display:flex;position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#111 0%,#444 100%);z-index:20001;justify-content:center;align-items:center;animation:fadeInLogin 0.7s;">
    <form id="form-login" class="login-card">
      <img src="imagens/Kz Logo.png" alt="Logo KzFlix" style="width:80px;height:80px;object-fit:cover;border-radius:18px;box-shadow:0 0 18px #4448,0 2px 12px #0008;margin-bottom:18px;">
      <h2 class="login-title">Bem-vindo ao KzFlix</h2>
      <div class="login-field">
        <span class="login-icon">👤</span>
        <input type="text" id="login-nome" placeholder="Seu nome" required>
      </div>
      <div class="login-field" style="position:relative;">
        <span class="login-icon">🔒</span>
        <input type="password" id="login-senha" placeholder="Sua senha" required style="padding-right:38px;">
        <button type="button" id="toggle-senha" aria-label="Mostrar senha" style="position:absolute;right:8px;background:none;border:none;color:#aaa;font-size:1.5rem;cursor:pointer;outline:none;top:50%;transform:translateY(-50%);padding:0;display:flex;align-items:center;">
          <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"></path><circle cx="12" cy="12" r="3"></circle></svg>
          <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#aaa" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none;"><path d="M17.94 17.94A10.94 10.94 0 0 1 12 19c-7 0-11-7-11-7a21.07 21.07 0 0 1 5.06-7.06"></path><path d="M1 1l22 22"></path></svg>
        </button>
      </div>
      <div id="login-erro" class="login-erro" style="margin-bottom:8px;"></div>
      <div id="msg-bem-vindo" style="display:none;text-align:center;font-size:1.1rem;color:#1db954;font-weight:bold;margin-top:8px;transition:opacity 0.7s;"></div>
      <button type="submit" class="login-btn">Entrar</button>
    </form>
  </div>
  <style>
    @keyframes fadeInLogin {
      from { opacity: 0; transform: scale(1.08); }
      to { opacity: 1; transform: scale(1); }
    }
    .login-card {
      backdrop-filter: blur(14px);
      background: rgba(24,24,24,0.97);
      padding: 38px 32px 32px 32px;
      border-radius: 28px;
      box-shadow: 0 8px 32px #2228,0 0 0 2px #4448;
      width: 100%;
      max-width: 370px;
      display: flex;
      flex-direction: column;
      gap: 22px;
      align-items: center;
      position: relative;
      border: 1.5px solid #4448;
      animation: fadeInLogin 0.7s;
    }
    .login-title {
      color: #f2f2f2;
      margin-bottom: 0;
      font-size: 2rem;
      font-family: 'Arial Black', 'Impact', Arial, sans-serif;
      letter-spacing: 2px;
      text-shadow: 0 2px 12px #222,0 2px 8px #0008;
      text-align: center;
    }
    .login-field {
      width: 100%;
      display: flex;
      align-items: center;
      background: rgba(44,44,44,0.92);
      border-radius: 12px;
      box-shadow: 0 2px 8px #2224;
      border: 1.5px solid #4448;
      margin-bottom: 2px;
      padding: 0 10px;
      transition: box-shadow 0.2s, border 0.2s;
    }
    .login-field:focus-within {
      box-shadow: 0 0 0 2px #444,0 2px 8px #2228;
      border: 1.5px solid #444;
    }
    .login-icon {
      font-size: 1.3rem;
      color: #888;
      margin-right: 8px;
      text-shadow: 0 0 8px #2228;
    }
    .login-field input {
      flex: 1;
      background: transparent;
      border: none;
      color: #f2f2f2;
      font-size: 1.1rem;
      padding: 14px 0;
      outline: none;
      letter-spacing: 1px;
      font-family: inherit;
      transition: color 0.2s;
    }
    .login-field input::placeholder {
      color: #888;
      font-size: 1rem;
      letter-spacing: 1px;
      font-family: inherit;
    }
    .login-btn {
      width: 100%;
      background: linear-gradient(90deg,#222 0%,#444 100%);
      color: #f2f2f2;
      font-size: 1.3rem;
      padding: 15px 0;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 0 18px #2228,0 2px 12px #4444;
      transition: background 0.3s,transform 0.2s,box-shadow 0.2s;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #222;
      margin-top: 10px;
    }
    .login-btn:hover {
      background: linear-gradient(90deg,#444 0%,#222 100%);
      transform: scale(1.04);
      box-shadow: 0 0 24px #444a,0 2px 12px #2224;
    }
    .login-erro {
      display: none;
      color: #888;
      font-size: 1rem;
      margin-top: 6px;
      text-align: center;
      text-shadow: 0 2px 8px #222;
      letter-spacing: 1px;
    }
    @media (max-width: 500px) {
      .login-card {
        max-width: 98vw;
        padding: 18px 6vw 18px 6vw;
      }
      .login-title {
        font-size: 1.2rem;
      }
      .login-btn {
        font-size: 1rem;
        padding: 12px 0;
      }
    }
  </style>
  <!-- Modal Player -->
  <div id="modal-player" role="dialog" aria-modal="true" tabindex="-1">
    <div style="position:relative; height:100%;">
      <button class="fullscreen-player" aria-label="Tela cheia" style="position:absolute;top:10px;right:10px;background:rgba(30,30,30,0.9);border:none;color:#fff;font-size:20px;padding:8px 12px;border-radius:50px;cursor:pointer;z-index:11;transition:background 0.3s;">⛶</button>
      <button class="fechar-player" aria-label="Fechar player" style="position:absolute;top:10px;right:60px;">❌</button>
      <iframe
        id="iframe-player"
        src=""
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
        title="Player de vídeo"
      ></iframe>
<button class="pular-capitulo-player-global" aria-label="Pular capítulo" style="position:absolute;right:18px;bottom:18px;background:#1db954;border:none;color:#fff;font-size:14px;padding:8px 18px;border-radius:24px;cursor:pointer;z-index:20000;transition:background 0.3s;display:none;box-shadow:0 2px 8px rgba(0,0,0,0.3);">⏭️ Pular Capítulo</button>
    </div>
  </div>
<script src="dados.js"></script>
<script>
// Login modal aprimorado
const modalLogin = document.getElementById("modal-login");
const formLogin = document.getElementById("form-login");
const loginErro = document.getElementById("login-erro");
const loginNome = document.getElementById('login-nome');
const loginSenha = document.getElementById('login-senha');
const loginUserBtns = document.querySelectorAll('.login-user-btn');

// Bloqueia rolagem ao abrir
document.body.classList.add('modal-aberto');

// Foca no campo nome ao abrir
window.addEventListener('DOMContentLoaded', () => {
  setTimeout(() => {
    loginNome.focus();
  }, 200);
});

// Impede fechar modal por clique ou ESC
modalLogin.addEventListener("click", (e) => {
  e.stopPropagation();
});
document.addEventListener("keydown", (e) => {
  if (modalLogin.style.display === "flex") {
    if (e.key === "Escape") {
      e.preventDefault();
    }
  }
});

// Botões de usuário
loginUserBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    loginNome.value = btn.getAttribute('data-nome');
    loginSenha.value = btn.getAttribute('data-senha');
    loginNome.focus();
    loginErro.style.display = 'none';
  });
});

formLogin.onsubmit = (e) => {
  e.preventDefault();
  const nome = loginNome.value.trim();
  const senha = loginSenha.value.trim();
  const msgBemVindo = document.getElementById('msg-bem-vindo');
  if (!nome || !senha) {
    loginErro.textContent = "Preencha todos os campos.";
    loginErro.style.display = "block";
    msgBemVindo.style.display = "none";
    return;
  }
  // Só permite os logins específicos
  const loginsValidos = [
    { nome: "Kzinn", senha: "renatamachado" },
    { nome: "Maxz", senha: "132607" },
    { nome: "pedro lisboa", senha: "2008pll#" },
    { nome: "simasturbo", senha: "01eles00nos" },
    { nome: "nunes", senha: "30104422" },
    { nome: "gtcbarbosa", senha: "081518" },
    { nome: "cardoso", senha: "gozarindo" },
    { nome: "Alan", senha: "12345" },
    { nome: "Julia", senha: "2702" },
    { nome: "jottameterebolando", senha: "peledosexo" },
    { nome: "jotaorugas", senha: "terrordoestado" },
    { nome: "Isabelly", senha: "1234" },
    { nome: "Caroline Mendonça", senha: "carolLinda2007" },
    { nome: "Fael", senha: "Barbeiro" }
  ];
  const valido = loginsValidos.some(l => l.nome === nome && l.senha === senha);
  if (!valido) {
    loginErro.textContent = "Login ou senha inválidos. Use um dos logins permitidos.";
    loginErro.style.display = "block";
    msgBemVindo.style.display = "none";
    return;
  }
  loginErro.style.display = "none";
  msgBemVindo.innerHTML = `<span style='font-size:1.5rem;vertical-align:middle;margin-right:6px;'>🎬</span>Bem-vindo, <b style='color:#1db954;'>${nome}</b>!`;
  msgBemVindo.style.display = 'block';
  msgBemVindo.style.opacity = '1';
  msgBemVindo.style.animation = '';
  // Delay de 3 segundos antes de liberar acesso
  setTimeout(() => {
    msgBemVindo.style.opacity = '0';
    setTimeout(() => { msgBemVindo.style.display = 'none'; }, 700);
    modalLogin.style.display = "none";
    document.body.classList.remove('modal-aberto');
  }, 3000);
  localStorage.setItem('usuarioLogado', nome);
  renderizarContinuarAssistindo();
};

// Mostrar/ocultar senha com SVG
const toggleSenha = document.getElementById('toggle-senha');
const eyeOpen = document.getElementById('eye-open');
const eyeClosed = document.getElementById('eye-closed');
toggleSenha.addEventListener('click', () => {
  if (loginSenha.type === 'password') {
    loginSenha.type = 'text';
    eyeOpen.style.display = 'none';
    eyeClosed.style.display = 'inline';
    toggleSenha.setAttribute('aria-label', 'Ocultar senha');
  } else {
    loginSenha.type = 'password';
    eyeOpen.style.display = 'inline';
    eyeClosed.style.display = 'none';
    toggleSenha.setAttribute('aria-label', 'Mostrar senha');
  }
});
    const lista = document.getElementById("lista");
    let dadosFiltrados = [];
    let limiteInicial = 0;
    const QUANTIDADE_POR_PAGINA = 10;
    const botoes = document.querySelectorAll(".filtros button");
    const campoBusca = document.getElementById("busca");
    const listaGeneros = document.getElementById("lista-generos");

    const modalEpisodios = document.getElementById("modal-episodios");
    const modalTitulo = document.getElementById("modal-titulo");
    const selectTemporada = document.getElementById("select-temporada");
    const selectEpisodio = document.getElementById("select-episodio");
    const btnAssistirEpisodio = document.getElementById("btn-assistir-episodio");
    const btnFecharModal = document.getElementById("btn-fechar-modal");

    const modalPlayer = document.getElementById("modal-player");
    const iframePlayer = document.getElementById("iframe-player");

    const btnFecharPlayer = modalPlayer.querySelector(".fechar-player");
    const btnFullscreenPlayer = modalPlayer.querySelector(".fullscreen-player");
    const btnPularCapitulo = document.querySelector('.pular-capitulo-player-global');

    // --- Controle de exibição do botão fullscreen no modo fullscreen ---
    let fullscreenBtnTimeout = null;
    let fullscreenBtnHidden = false;
    function hideFullscreenBtn() {
      if (modalPlayer.classList.contains('simulacao-fullscreen-mobile') || document.fullscreenElement) {
        btnFullscreenPlayer.classList.add('fullscreen-btn-hide');
        fullscreenBtnHidden = true;
      }
    }
    function showFullscreenBtn() {
      btnFullscreenPlayer.classList.remove('fullscreen-btn-hide');
      fullscreenBtnHidden = false;
      if (modalPlayer.classList.contains('simulacao-fullscreen-mobile') || document.fullscreenElement) {
        if (fullscreenBtnTimeout) clearTimeout(fullscreenBtnTimeout);
        fullscreenBtnTimeout = setTimeout(hideFullscreenBtn, 3000);
      }
    }
    // Detecta movimento para reexibir
    function setupFullscreenBtnAutoHide() {
      const eventos = [
        "mousemove", "pointermove", "touchstart", "touchmove", "keydown", "wheel"
      ];
      // Document (fora do player)
      eventos.forEach(ev => {
        document.addEventListener(ev, () => {
          if (modalPlayer.classList.contains('simulacao-fullscreen-mobile') || document.fullscreenElement) {
            showFullscreenBtn();
          }
        }, { passive: true });
      });
      // Modal player (dentro do player, exceto iframe)
      eventos.forEach(ev => {
        modalPlayer.addEventListener(ev, () => {
          if (modalPlayer.classList.contains('simulacao-fullscreen-mobile') || document.fullscreenElement) {
            showFullscreenBtn();
          }
        }, { passive: true });
      });

      // Overlay para capturar eventos sobre o iframe
      let overlay = null;
      function addOverlay() {
        if (!overlay) {
          overlay = document.createElement('div');
          overlay.style.position = 'absolute';
          overlay.style.top = 0;
          overlay.style.left = 0;
          overlay.style.width = '100%';
          overlay.style.height = '100%';
          overlay.style.zIndex = 10;
          overlay.style.background = 'transparent';
          overlay.style.pointerEvents = 'none';
          overlay.style.display = 'none';
          // Só ativa pointer-events quando o botão está oculto
          ['mousemove','pointermove','touchmove'].forEach(ev => {
            overlay.addEventListener(ev, () => {
              if (modalPlayer.classList.contains('simulacao-fullscreen-mobile') || document.fullscreenElement) {
                showFullscreenBtn();
                overlay.style.pointerEvents = 'none'; // volta a não bloquear
              }
            }, { passive: true });
          });
          overlay.tabIndex = -1;
          const modalDiv = modalPlayer.querySelector('div');
          modalDiv.appendChild(overlay);
        }
        overlay.style.display = 'block';
        // Se o botão está oculto, ativa pointer-events para capturar movimento
        if (btnFullscreenPlayer.classList.contains('fullscreen-btn-hide')) {
          overlay.style.pointerEvents = 'auto';
        } else {
          overlay.style.pointerEvents = 'none';
        }
      }
      function removeOverlay() {
        if (overlay) overlay.style.display = 'none';
      }

      // Sempre que o botão some, overlay ativa pointer-events
      function monitorBtnState() {
        const obsBtn = new MutationObserver(() => {
          if (!overlay) return;
          if (btnFullscreenPlayer.classList.contains('fullscreen-btn-hide')) {
            overlay.style.pointerEvents = 'auto';
          } else {
            overlay.style.pointerEvents = 'none';
          }
        });
        obsBtn.observe(btnFullscreenPlayer, { attributes: true, attributeFilter: ['class'] });
      }
      monitorBtnState();
      // Ativa/desativa overlay conforme fullscreen
      document.addEventListener('fullscreenchange', () => {
        if (document.fullscreenElement || modalPlayer.classList.contains('simulacao-fullscreen-mobile')) {
          addOverlay();
        } else {
          removeOverlay();
        }
      });
      // Também observa simulação mobile
      const obs = new MutationObserver(() => {
        if (modalPlayer.classList.contains('simulacao-fullscreen-mobile')) {
          addOverlay();
        } else {
          removeOverlay();
        }
      });
      obs.observe(modalPlayer, { attributes: true, attributeFilter: ['class'] });
    }
    setupFullscreenBtnAutoHide();

    // Reposiciona o botão abaixo do modal player ao abrir
    function posicionarPularCapitulo() {
      // modalDiv já foi declarado acima
      if (!modalPlayer.classList.contains('show')) {
        btnPularCapitulo.style.display = 'none';
        return;
      }
      // Pega a posição do modal na tela
      const rect = modalDiv.getBoundingClientRect();
      btnPularCapitulo.style.position = 'absolute';
      btnPularCapitulo.style.left = (rect.right - btnPularCapitulo.offsetWidth) + 'px';
      btnPularCapitulo.style.top = (rect.bottom + 12 + window.scrollY) + 'px';
      btnPularCapitulo.style.right = '';
      btnPularCapitulo.style.bottom = '';
    }

    // Chama ao abrir modal player e ao redimensionar
    window.addEventListener('resize', () => {
      if (btnPularCapitulo.style.display !== 'none') {
        posicionarPularCapitulo();
      }
    });

    // Variáveis para controle do episódio atual
    window.episodioAtualInfo = null;
    let tipoFiltro = "all";
    let filtroGenero = "all";
    let serieAtual = null; // <-- Adiciona variável global para guardar a série aberta

    // Exibir lista inicial
    exibirLista(dados, true);

    // Filtrar por tipo (Filme, Série, Todos)
    botoes.forEach((botao) => {
      botao.addEventListener("click", () => {
        botoes.forEach((b) => {
          b.classList.remove("active");
          b.setAttribute("aria-pressed", "false");
        });
        botao.classList.add("active");
        botao.setAttribute("aria-pressed", "true");
        tipoFiltro = botao.getAttribute("data-type");
        campoBusca.value = "";
        filtroGenero = "all";
        listaGeneros.style.display = "none";
        exibirLista(filtrarDados(), true);
        document.getElementById("btn-home").style.display = tipoFiltro === "all" ? "none" : "inline-block";
      });
    });

    // Botão sair da pesquisa
    document.getElementById("btn-home").addEventListener("click", () => {
      tipoFiltro = "all";
      filtroGenero = "all";
      campoBusca.value = "";
      listaGeneros.style.display = "none";
      botoes.forEach((b) => {
        b.classList.remove("active");
        b.setAttribute("aria-pressed", "false");
      });
      botoes[0].classList.add("active");
      botoes[0].setAttribute("aria-pressed", "true");
      exibirLista(dados, true);
      document.getElementById("btn-home").style.display = "none";
    });

    // Mostrar/ocultar lista de gêneros
    campoBusca.addEventListener("focus", () => {
      listaGeneros.style.display = "block";
    });

    campoBusca.addEventListener("blur", () => {
      setTimeout(() => {
        listaGeneros.style.display = "none";
      }, 150);
    });

    // Seleção de gênero da lista
    listaGeneros.querySelectorAll("li").forEach((item) => {
      item.addEventListener("click", () => {
        filtroGenero = item.getAttribute("data-genero");
        campoBusca.value = filtroGenero === "all" ? "" : filtroGenero;
        exibirLista(filtrarDados(), true);
        listaGeneros.style.display = "none";
      });
      item.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          item.click();
        }
      });
    });

    // Busca por título ou gênero no campo de busca
    campoBusca.addEventListener("input", () => {
      filtroGenero = campoBusca.value.toLowerCase();
      exibirLista(filtrarDados(), true);
    });

    function getCardsLimit() {
  // Se for desktop grande, mostra 14 cards por vez
  if (window.innerWidth >= 1800 && window.innerHeight >= 900) return 14;
  return 10;
}

    // Função que filtra os dados de acordo com os filtros
    function filtrarDados() {
      return dados.filter((item) => {
        const tipoOk = tipoFiltro === "all" || item.tipo === tipoFiltro;
        const buscaTexto = campoBusca.value.trim().toLowerCase();

        // Verificar busca no título
        const buscaTitulo = item.titulo.toLowerCase().includes(buscaTexto);

        // Verificar busca no gênero
        const buscaGenero =
          filtroGenero === "all" ||
          item.generos.some((g) => g.toLowerCase().includes(filtroGenero));

        return tipoOk && (buscaTitulo || buscaGenero);
      });
    }

    // Atualize o uso do limite em todas as telas:
    // Exibir lista principal
    function exibirLista(listaDados, reset = true) {
      const btnMais = document.getElementById("btn-carregar-mais");
      const QUANTIDADE_POR_PAGINA = getCardsLimit();

      if (reset) {
        lista.innerHTML = "";
        limiteInicial = 0;
        dadosFiltrados = listaDados;
      }

      const proximoLote = dadosFiltrados.slice(limiteInicial, limiteInicial + QUANTIDADE_POR_PAGINA);

      if (proximoLote.length === 0 && limiteInicial === 0) {
        lista.innerHTML = "<p style='text-align:center;'>Nenhum resultado encontrado.</p>";
        btnMais.style.display = "none";
        return;
      }

      proximoLote.forEach((item) => {
        const card = document.createElement("article");
        card.className = "card";
        card.setAttribute("tabindex", "0");
        card.setAttribute("role", "region");
        card.setAttribute("aria-label", item.titulo);

        const img = document.createElement("img");
        img.src = item.imagem;
        img.alt = `Imagem do ${item.tipo === "movie" ? "filme" : "série"} ${item.titulo}`;

        const anoOverlay = document.createElement("div");
        anoOverlay.className = "card-ano-overlay";
        anoOverlay.textContent = item.ano || "";

        const cardBody = document.createElement("div");
        cardBody.className = "card-body";

        const titulo = document.createElement("h3");
        titulo.className = "card-title";
        titulo.textContent = item.titulo;

        const ano = document.createElement("p");
        ano.className = "card-ano";
        ano.textContent = item.ano || "";

        const desc = document.createElement("p");
        desc.className = "card-desc";
        desc.textContent = item.descricao;

        cardBody.appendChild(titulo);
        cardBody.appendChild(ano);
        cardBody.appendChild(desc);

        const botoesContainer = document.createElement("div");
        botoesContainer.className = "vitrine-botoes";

        const btnAssistir = document.createElement("button");
        btnAssistir.className = "assistir-btn";
        btnAssistir.textContent = "▶️ Assistir";
        btnAssistir.setAttribute("aria-label", `Assistir ${item.titulo}`);
        btnAssistir.addEventListener("click", () => {
          if (item.tipo === "movie") abrirModalPlayer(item.video);
          else abrirModalEpisodios(item);
        });
        botoesContainer.appendChild(btnAssistir);

        if (item.trailer) {
          const btnTrailer = document.createElement("button");
          btnTrailer.className = "assistir-btn trailer";
          btnTrailer.textContent = "▶️ Trailer";
          btnTrailer.addEventListener("click", () => abrirModalPlayer(item.trailer));
          botoesContainer.appendChild(btnTrailer);
        }

        cardBody.appendChild(botoesContainer);
        card.appendChild(img);
        card.appendChild(cardBody);
        lista.appendChild(card);
      });

      limiteInicial += QUANTIDADE_POR_PAGINA;
      btnMais.style.display = limiteInicial < dadosFiltrados.length ? "block" : "none";
}


    // Modal Episódios
    function abrirModalEpisodios(serie) {
      serieAtual = serie; // <-- Guarda a série atualmente aberta
      modalTitulo.textContent = `Temporadas de ${serie.titulo}`;
      selectTemporada.innerHTML = "";
      selectEpisodio.innerHTML = "";
      btnAssistirEpisodio.disabled = true;

      serie.temporadas.forEach((temp) => {
        const option = document.createElement("option");
        option.value = temp.numero;
        option.textContent = `Temporada ${temp.numero}`;
        selectTemporada.appendChild(option);
      });

      // Quando mudar a temporada, carregar os episódios
      selectTemporada.onchange = () => {
        carregarEpisodios(serie, Number(selectTemporada.value));
      };

      // Inicializa com a primeira temporada
      if (serie.temporadas.length > 0) {
        selectTemporada.value = serie.temporadas[0].numero;
        carregarEpisodios(serie, serie.temporadas[0].numero);
      }

      modalEpisodios.style.display = "flex";
      modalEpisodios.focus();

      btnFecharModal.onclick = fecharModalEpisodios;
    }

    function carregarEpisodios(serie, numTemporada) {
      selectEpisodio.innerHTML = "";
      const temporada = serie.temporadas.find((t) => t.numero === numTemporada);
      if (!temporada) return;

      temporada.episodios.forEach((epi) => {
        const option = document.createElement("option");
        option.value = epi.numero;
        option.textContent = `Episódio ${epi.numero} - ${epi.titulo}`;
        selectEpisodio.appendChild(option);
      });

      selectEpisodio.value = temporada.episodios[0].numero;
      btnAssistirEpisodio.disabled = false;
    }

    btnAssistirEpisodio.onclick = () => {
      const numTemp = Number(selectTemporada.value);
      const numEpi = Number(selectEpisodio.value);
      if (!serieAtual) return;
      const temporada = serieAtual.temporadas.find((t) => t.numero === numTemp);
      if (!temporada) return;
      const episodio = temporada.episodios.find((e) => e.numero === numEpi);
      if (!episodio) return;
      abrirModalPlayer(episodio.video, {
        tipo: 'serie',
        serie: serieAtual,
        temporada: numTemp,
        episodio: numEpi
      });
      fecharModalEpisodios();
    };

    function fecharModalEpisodios() {
      modalEpisodios.style.display = "none";
    }


    // Modal Player
    function abrirModalPlayer(link, infoEpisodio = null, tempoInicial = null) {
      let usuario = localStorage.getItem('usuarioLogado');
      let idVideo = link.split('?')[0];
      let tempoSalvo = tempoInicial != null ? tempoInicial : (usuario ? obterTempoAssistido(usuario, idVideo) : 0);

      // Adiciona ?start=tempo na URL do Google Drive se houver tempo salvo
      let url = link;
      if (tempoSalvo > 0) {
        url += (url.includes('?') ? '&' : '?') + 'start=' + Math.floor(tempoSalvo);
      }
      iframePlayer.src = url;
      modalPlayer.classList.add("show");
      modalPlayer.focus();
      episodioAtualInfo = infoEpisodio;
      document.body.classList.add('modal-aberto');
      const metaViewport = document.getElementById('meta-viewport');
      if (metaViewport) {
        metaViewport.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
      }
      // Exibe botão pular capítulo ou próxima temporada
      if (infoEpisodio && infoEpisodio.tipo === 'serie') {
        const serie = infoEpisodio.serie;
        const numTemp = infoEpisodio.temporada;
        const numEpi = infoEpisodio.episodio;
        const temporada = serie.temporadas.find(t => t.numero === numTemp);
        const proxTemp = serie.temporadas.find(t => t.numero === numTemp + 1);
        const ehUltimoEpi = numEpi === temporada.episodios.length;
        const temProximoEpi = numEpi < temporada.episodios.length;
        const temProximaTemporada = proxTemp && proxTemp.episodios.length > 0;

        if (temProximoEpi) {
          btnPularCapitulo.textContent = '⏭️ Pular Capítulo';
          btnPularCapitulo.style.display = 'inline-block';
          btnPularCapitulo.disabled = false;
        } else if (ehUltimoEpi && temProximaTemporada) {
          btnPularCapitulo.textContent = '⏭️ Próxima Temporada';
          btnPularCapitulo.style.display = 'inline-block';
          btnPularCapitulo.disabled = false;
        } else {
          btnPularCapitulo.style.display = 'none';
        }
        btnPularCapitulo.style.position = 'absolute';
        btnPularCapitulo.style.bottom = '18px';
        btnPularCapitulo.style.right = '18px';
        btnPularCapitulo.style.left = 'auto';
        btnPularCapitulo.style.top = '';
        btnPularCapitulo.style.zIndex = '20000';
        btnPularCapitulo.style.visibility = 'visible';
        btnPularCapitulo.style.opacity = '1';
      } else {
        btnPularCapitulo.style.display = 'none';
      }

      // Exibe botão salvar ponto
      btnSalvarPonto.style.display = 'inline-block';
      btnSalvarPonto.onclick = function() {
        mostrarPopupSalvarTempo();
      };
    }

    // Fullscreen e orientação paisagem
    btnFullscreenPlayer.onclick = async function() {
      const modalDiv = modalPlayer.querySelector('div');
      const isMobile = /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|Mobile/i.test(navigator.userAgent);
      // Sempre tenta fullscreen nativo primeiro
      if (!document.fullscreenElement) {
        // Oculta todos os botões, exceto o fullscreen
        btnFecharPlayer.style.display = 'none';
        btnPularCapitulo.style.display = 'none';
        btnSalvarPonto.style.display = 'none';
        btnFullscreenPlayer.style.display = 'block';
        let entrouFullscreen = false;
        // Tenta API nativa
        if (modalDiv.requestFullscreen) {
          try {
            await modalDiv.requestFullscreen();
            entrouFullscreen = true;
          } catch (e) {}
        } else if (modalDiv.webkitRequestFullscreen) {
          try {
            await modalDiv.webkitRequestFullscreen();
            entrouFullscreen = true;
          } catch (e) {}
        } else if (modalDiv.msRequestFullscreen) {
          try {
            await modalDiv.msRequestFullscreen();
            entrouFullscreen = true;
          } catch (e) {}
        }
        // Tenta travar orientação para landscape
        if (screen.orientation && screen.orientation.lock) {
          try {
            await screen.orientation.lock('landscape');
          } catch (e) {}
        }
        // Se não entrou em fullscreen nativo, simula no mobile
        if (!entrouFullscreen && isMobile) {
          const jaFullscreen = modalPlayer.classList.contains('simulacao-fullscreen-mobile');
          let aviso = document.getElementById('aviso-orientacao');
          if (!jaFullscreen) {
            modalPlayer.classList.add('simulacao-fullscreen-mobile');
            btnFecharPlayer.style.display = 'none';
            btnPularCapitulo.style.display = 'none';
            btnFullscreenPlayer.style.display = 'block';
            // Mensagem para girar o aparelho se não travou
            if (!aviso) {
              aviso = document.createElement('div');
              aviso.id = 'aviso-orientacao';
              aviso.innerText = 'Gire o aparelho para paisagem para melhor experiência.';
              aviso.style.position = 'fixed';
              aviso.style.bottom = '24px';
              aviso.style.left = '50%';
              aviso.style.transform = 'translateX(-50%)';
              aviso.style.background = 'rgba(0,0,0,0.8)';
              aviso.style.color = '#fff';
              aviso.style.padding = '10px 18px';
              aviso.style.borderRadius = '20px';
              aviso.style.fontSize = '16px';
              aviso.style.zIndex = '100001';
              document.body.appendChild(aviso);
              setTimeout(() => {
                if (aviso) aviso.remove();
              }, 4000);
            }
          }
        }
      } else {
        // Sai do fullscreen nativo ou simulado
        if (document.exitFullscreen) {
          try {
            await document.exitFullscreen();
          } catch (e) {}
        } else if (document.webkitExitFullscreen) {
          try {
            await document.webkitExitFullscreen();
          } catch (e) {}
        } else if (document.msExitFullscreen) {
          try {
            await document.msExitFullscreen();
          } catch (e) {}
        }
        if (screen.orientation && screen.orientation.unlock) {
          try { screen.orientation.unlock(); } catch (e) {}
        }
        // Remove simulação se estiver ativa
        if (modalPlayer.classList.contains('simulacao-fullscreen-mobile')) {
          modalPlayer.classList.remove('simulacao-fullscreen-mobile');
          btnFecharPlayer.style = '';
          let aviso = document.getElementById('aviso-orientacao');
          if (aviso) aviso.remove();
        }
        // Reexibe botões se necessário
        btnFecharPlayer.style.display = '';
        if (episodioAtualInfo && episodioAtualInfo.tipo === 'serie') {
          btnPularCapitulo.style.display = 'inline-block';
        }
      }
    };

    // Reexibe botões ao sair do fullscreen
    document.addEventListener('fullscreenchange', () => {
      if (!document.fullscreenElement) {
        // Reexibe botões ao sair do fullscreen
        btnFecharPlayer.style.display = '';
        btnFullscreenPlayer.style.display = 'block';
        btnFullscreenPlayer.classList.remove('fullscreen-btn-hide');
        fullscreenBtnHidden = false;
        if (fullscreenBtnTimeout) clearTimeout(fullscreenBtnTimeout);
        btnSalvarPonto.style.display = 'inline-block';
        if (episodioAtualInfo && episodioAtualInfo.tipo === 'serie') {
          btnPularCapitulo.style.display = 'inline-block';
        } else {
          btnPularCapitulo.style.display = 'none';
        }
      } else {
        // Entrou em fullscreen: inicia timer para esconder
        showFullscreenBtn();
      }
    });
    // Esconde botão fullscreen ao entrar em simulação mobile
    const observer = new MutationObserver(() => {
      if (modalPlayer.classList.contains('simulacao-fullscreen-mobile')) {
        showFullscreenBtn();
      } else {
        btnFullscreenPlayer.classList.remove('fullscreen-btn-hide');
        fullscreenBtnHidden = false;
        if (fullscreenBtnTimeout) clearTimeout(fullscreenBtnTimeout);
      }
    });
    observer.observe(modalPlayer, { attributes: true, attributeFilter: ['class'] });
    // CSS para esconder o botão fullscreen suavemente
    const style = document.createElement('style');
    style.innerHTML = `.fullscreen-btn-hide { opacity: 0 !important; pointer-events: none !important; transition: opacity 0.4s; }`;
    document.head.appendChild(style);

    btnFecharPlayer.onclick = async function() {
      let saiuDoFullscreen = false;
      if (document.fullscreenElement) {
        try {
          if (document.exitFullscreen) {
            await document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            await document.webkitExitFullscreen();
          } else if (document.msExitFullscreen) {
            await document.msExitFullscreen();
          }
          saiuDoFullscreen = true;
        } catch (e) {}
        // Desbloqueia orientação
        if (screen.orientation && screen.orientation.unlock) {
          try { screen.orientation.unlock(); } catch (e) {}
        }
      }
      // Sempre fecha o modal, aguarda se saiu do fullscreen
      if (saiuDoFullscreen) {
        setTimeout(() => {
          fecharModalPlayer();
        }, 200);
      } else {
        fecharModalPlayer();
      }
    }

    // Função para pular capítulo
    btnPularCapitulo.onclick = function() {
      if (!episodioAtualInfo || episodioAtualInfo.tipo !== 'serie') return;
      const serie = episodioAtualInfo.serie;
      let numTemp = episodioAtualInfo.temporada;
      let numEpi = episodioAtualInfo.episodio;
      const temporada = serie.temporadas.find(t => t.numero === numTemp);
      if (!temporada) return;
      const proxTemp = serie.temporadas.find(t => t.numero === numTemp + 1);

      // Próximo episódio na mesma temporada
      if (numEpi < temporada.episodios.length) {
        const proximoEpi = temporada.episodios.find(e => e.numero === numEpi + 1);
        if (proximoEpi) {
          abrirModalPlayer(proximoEpi.video, {
            tipo: 'serie',
            serie: serie,
            temporada: numTemp,
            episodio: numEpi + 1
          });
          return;
        }
      }
      // Se for último episódio e tem próxima temporada, vai para o primeiro episódio da próxima temporada
      if (numEpi === temporada.episodios.length && proxTemp && proxTemp.episodios.length > 0) {
        abrirModalPlayer(proxTemp.episodios[0].video, {
          tipo: 'serie',
          serie: serie,
          temporada: numTemp + 1,
          episodio: 1
        });
        return;
      }
      // Se não há mais episódios, oculta o botão
      btnPularCapitulo.style.display = 'none';
    };

    // Fechar modal player ao clicar fora do iframe
    modalPlayer.addEventListener("click", (e) => {
      if (e.target === modalPlayer) {
        fecharModalPlayer();
      }
    });

    // Função robusta para fechar o modal player
    function fecharModalPlayer() {
      modalPlayer.classList.remove("show");
      iframePlayer.src = "";
      btnPularCapitulo.style.display = "none";
      btnSalvarPonto.style.display = "none";
      episodioAtualInfo = null;
      // Libera rolagem e zoom
      document.body.classList.remove('modal-aberto');
      const metaViewport = document.getElementById('meta-viewport');
      if (metaViewport) {
        metaViewport.setAttribute('content', 'width=device-width, initial-scale=1');
      }
    }

    // Fechar modal episódios ao clicar fora
    modalEpisodios.addEventListener("click", (e) => {
      if (e.target === modalEpisodios) {
        fecharModalEpisodios();
      }
    });

    // Para fechar modais com ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (modalPlayer.style.display === "flex") {
          fecharModalPlayer();
        }
        if (modalEpisodios.style.display === "flex") {
          fecharModalEpisodios();
        }
      }
    });
    const btnPerfil = document.getElementById("btn-perfil");
    const menuPerfil = document.getElementById("menu-perfil");
    const toggleDark = document.getElementById("toggle-dark");

    // Corrige o menu lateral para abrir e fechar corretamente ao clicar no botão de perfil
    if (btnPerfil) {
      btnPerfil.addEventListener("click", (e) => {
        e.stopPropagation(); // Evita fechar ao clicar no próprio botão
        atualizarMenuPerfil();
        if (menuPerfil) {
          menuPerfil.style.display = menuPerfil.style.display === "block" ? "none" : "block";
        }
      });
    }
    // Fecha o menu ao clicar fora dele
    if (menuPerfil) {
      document.addEventListener("click", (e) => {
        if (menuPerfil.style.display === "block" && !menuPerfil.contains(e.target) && e.target !== btnPerfil) {
          menuPerfil.style.display = "none";
        }
      });
    }

    // Garante que o menu lateral seja sempre reconstruído ao abrir, incluindo Donate
    if (btnPerfil) {
      btnPerfil.addEventListener("click", () => {
        atualizarMenuPerfil(); // Reconstrói o menu toda vez que abrir
        if (menuPerfil) {
          menuPerfil.style.display = menuPerfil.style.display === "block" ? "none" : "block";
        }
      });
    }

    // Garante que o menu começa vazio e é sempre reconstruído
    function atualizarMenuPerfil() {
      if (menuPerfil) {
        menuPerfil.innerHTML = '';
        // Donate
        const liDonate = document.createElement('li');
        liDonate.role = 'menuitem';
        liDonate.tabIndex = 0;
        liDonate.textContent = '💸 Donate';
        liDonate.className = 'menu-btn';
        liDonate.onclick = () => { mostrarPopupPix(); };
        liDonate.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        mostrarPopupPix();
      }
    });
        menuPerfil.appendChild(liDonate);
        // Download APK
        const liDownloadApk = document.createElement('li');
        liDownloadApk.role = 'menuitem';
        liDownloadApk.tabIndex = 0;
        liDownloadApk.textContent = '📲 Download APK';
        liDownloadApk.className = 'menu-btn';
        liDownloadApk.onclick = () => {
          window.open('https://www.mediafire.com/file/ts62shgl7t4wfm6/KzFlix.apk/file', '_blank');
        };
        menuPerfil.appendChild(liDownloadApk);
        // Dark mode
        const liDark = document.createElement('li');
        liDark.role = 'menuitem';
        liDark.tabIndex = 0;
        liDark.textContent = '🌙 Alterar Dark Mode';
        liDark.className = 'menu-btn';
        liDark.onclick = () => {
          document.body.classList.toggle('modo-claro');
          localStorage.setItem('modo', document.body.classList.contains('modo-claro') ? 'claro' : 'escuro');
        };
        menuPerfil.appendChild(liDark);
      }
    }

    btnPerfil.addEventListener("click", () => {
      menuPerfil.style.display = menuPerfil.style.display === "block" ? "none" : "block";
    });

    // Fechar menu clicando fora
    document.addEventListener("click", (e) => {
      if (!menuPerfil.contains(e.target) && e.target !== btnPerfil) {
        menuPerfil.style.display = "none";
      }
    });

    // Alternar modo escuro
    toggleDark.addEventListener("click", () => {
      document.body.classList.toggle("modo-claro");
      localStorage.setItem("modo", document.body.classList.contains("modo-claro") ? "claro" : "escuro");
    });
    // Carregar tema salvo
    if (localStorage.getItem("modo") === "claro") {
      document.body.classList.add("modo-claro");
    }
    document.getElementById("btn-carregar-mais").addEventListener("click", () => {
    exibirLista(dadosFiltrados, false);
    });
    // Exibir lançamentos recentes (com base em alguns títulos)
    function exibirLancamentosRecentes() {
  const ordemDesejada = [
    "Wandinha",
    "Jurassic World: Recomeço",
    "M3GAN 2.0",
    "Como Treinar o Seu Dragão",
    "Karatê Kid: Lendas",
    "Alien: Romulus",
    "Barbie",
    "Oppenheimer",
    "Exterminio: A Evolução",
    "Um Maluco No Golfe 2",
  ];
  const lancamentosRecentes = ordemDesejada
    .map(titulo => dados.find(item => item.titulo === titulo))
    .filter(Boolean)
    .slice(0, getCardsLimit());
  const vitrineContainer = document.getElementById("vitrine-lancamentos");
  vitrineContainer.innerHTML = ""; // Limpa vitrine antes de adicionar

  lancamentosRecentes.forEach((item, index) => {
    const card = document.createElement("div");
    card.className = "vitrine-card";

    const img = document.createElement("img");
    img.src = item.imagem;
    img.alt = `Imagem do lançamento ${item.titulo}`;

    const info = document.createElement("div");
    info.className = "vitrine-info";

    const h3 = document.createElement("h3");
    h3.textContent = `${index + 1}. ${item.titulo}`;

    const botoes = document.createElement("div");
    botoes.className = "vitrine-botoes";

    const btnAssistir = document.createElement("button");
    btnAssistir.textContent = "▶️ Assistir";
    btnAssistir.onclick = () => {
      if (item.tipo === "movie") abrirModalPlayer(item.video);
      else abrirModalEpisodios(item);
    };

    botoes.appendChild(btnAssistir);

    if (item.trailer) {
      const btnTrailer = document.createElement("button");
      btnTrailer.textContent = "▶️ Trailer";
      btnTrailer.classList.add("trailer");
      btnTrailer.onclick = () => abrirModalPlayer(item.trailer);
      botoes.appendChild(btnTrailer);
    }

    info.appendChild(h3);
    info.appendChild(botoes);
    card.appendChild(img);
    card.appendChild(info);
    vitrineContainer.appendChild(card);
  });
}

// Chama ao carregar a página
exibirLancamentosRecentes();



// Funções utilitárias para salvar e obter tempo
function salvarTempoAssistido(usuario, idVideo, tempoSegundos, info) {
  if (!usuario || !idVideo) return;
  // Se for série, remove todos os registros anteriores dessa série para o usuário
  if (info && (info.tipo === 'serie' || info.tipo === 'series')) {
    const prefix = `visto_${usuario}_`;
    const serieTitulo = (info.serie && info.serie.titulo) ? info.serie.titulo : info.titulo;
    for (let i = localStorage.length - 1; i >= 0; i--) {
      const k = localStorage.key(i);
      if (k.startsWith(prefix)) {
        try {
          const obj = JSON.parse(localStorage.getItem(k));
          if (obj && (obj.tipo === 'serie' || obj.tipo === 'series')) {
            const objSerieTitulo = (obj.serie && obj.serie.titulo) ? obj.serie.titulo : obj.titulo;
            if (objSerieTitulo === serieTitulo) {
              localStorage.removeItem(k);
            }
          }
        } catch {}
      }
    }
  }
  const chave = `visto_${usuario}_${idVideo}`;
  // Salva todos os campos do objeto info, não apenas tempo
  localStorage.setItem(chave, JSON.stringify({
    ...info,
    video: idVideo,
    tempo: tempoSegundos || 0
  }));
}

function obterContinuarAssistindo(usuario) {
  if (!usuario) return [];
  const prefix = `visto_${usuario}_`;
  const vistos = [];
  const seriesMap = {};
  // Percorre do final para o início para pegar o último registro salvo de cada série
  for (let i = localStorage.length - 1; i >= 0; i--) {
    const k = localStorage.key(i);
    if (k.startsWith(prefix)) {
      try {
        const obj = JSON.parse(localStorage.getItem(k));
        if (obj && obj.titulo && obj.video && obj.imagem && /^(imagens\/.*\.(jpg|jpeg|png|webp))$/i.test(obj.imagem)) {
          if ((obj.tipo === 'series' || obj.tipo === 'serie')) {
            // Para séries, identifica pelo serie.titulo ou titulo
            const key = (obj.serie && obj.serie.titulo) ? obj.serie.titulo : obj.titulo;
            if (!seriesMap[key]) {
              seriesMap[key] = obj;
            }
          } else {
            // Filmes e trailers adiciona normalmente
            vistos.push(obj);
          }
        }
      } catch {}
    }
  }
  // Adiciona o último episódio salvo de cada série
  Object.values(seriesMap).forEach(obj => vistos.push(obj));
  // Mantém ordem de salvamento (ordem de inserção no localStorage)
  return vistos;
}

function obterTempoAssistido(usuario, idVideo) {
  if (!usuario || !idVideo) return 0;
  const chave = `visto_${usuario}_${idVideo}`;
  const obj = localStorage.getItem(chave);
  if (!obj) return 0;
  try {
    return JSON.parse(obj).tempo || 0;
  } catch (e) {
    return 0;
  }
}

// Renderiza os cards de continuar assistindo
function renderizarContinuarAssistindo() {
  const usuario = localStorage.getItem('usuarioLogado');
  const container = document.getElementById('vitrine-continuar');
  const btnLimpar = document.getElementById('btn-limpar-historico');
  const secao = document.getElementById('continuar-assistindo');
  if (!container) return;
  container.innerHTML = '';
  const vistos = obterContinuarAssistindo(usuario);

  // Mostra ou esconde o botão de limpar histórico
  if (btnLimpar) btnLimpar.style.display = vistos.length ? 'inline-block' : 'none';
  // Mostra ou esconde toda a seção "Continuar Assistindo"
  if (secao) secao.style.display = vistos.length ? 'block' : 'none';

  if (!vistos.length) {
    container.innerHTML = "<p style='text-align:center;width:100%;color:#aaa;'>Nenhum conteúdo assistido.</p>";
    return;
  }
  vistos.forEach(obj => {
    let imagem = obj.imagem;
    if (!imagem || !/^(imagens\/.*\.(jpg|jpeg|png|webp))$/i.test(imagem)) return;
    if (obj.titulo) {
      const card = document.createElement('div');
      card.className = 'vitrine-card';
      card.style.cursor = 'pointer';
      let infoExtra = '';
      if ((obj.tipo === 'series' || obj.tipo === 'serie') && (obj.temporada || obj.episodio)) {
        infoExtra = `<p style='font-size:13px;color:#ccc;margin:2px 0 6px 0;'>Temporada ${obj.temporada || ''} Episódio ${obj.episodio || ''}</p>`;
      }
      card.innerHTML = `
        <img src="${imagem}" alt="Capa de ${obj.titulo}">
        <div class="vitrine-info">
          <h3>${obj.titulo}</h3>
          ${infoExtra}


          <p>🕒 Último ponto: ${formatarTempo(obj.tempo)}</p>
          <div class="vitrine-botoes">
            <button class="continuar-btn" style="background:#1db954;color:#fff;border:none;padding:6px 14px;border-radius:6px;cursor:pointer;font-size:13px;">Continuar</button>
          </div>
        </div>
      `;
      function getSerieCompleta(titulo) {
        if (typeof dados !== 'undefined') {
          return dados.find(f => (f.tipo === 'series' || f.tipo === 'serie') && f.titulo === titulo);
        }
        return { titulo };
      }
      card.querySelector('.continuar-btn').onclick = (e) => {
        e.stopPropagation();
        abrirModalPlayer(obj.video, (obj.tipo === 'series' || obj.tipo === 'serie') ? {
          tipo: 'serie',
          serie: getSerieCompleta(obj.titulo),
          temporada: obj.temporada,
          episodio: obj.episodio
        } : null, obj.tempo);
      };
      card.onclick = () => {
        abrirModalPlayer(obj.video, (obj.tipo === 'series' || obj.tipo === 'serie') ? {
          tipo: 'serie',
          serie: getSerieCompleta(obj.titulo),
          temporada: obj.temporada,
          episodio: obj.episodio
        } : null, obj.tempo);
      };
      container.appendChild(card);
    }
  });
}

// Formata tempo em segundos para mm:ss
function formatarTempo(segundos) {
  const h = Math.floor(segundos / 3600);
  const m = Math.floor((segundos % 3600) /  60);
  const s = Math.floor(segundos % 60);

  let str = '';
  if (h > 0) str += `${h}h`;
  if (m > 0 || h > 0) str += `${m.toString().padStart(2, '0')}m`;
  str += `${s.toString().padStart(2, '0')}s`;
  return str;
}

// Adiciona botão "Salvar ponto" no player
(function criarBtnSalvarPonto() {
  const modalDiv = modalPlayer.querySelector('div');
  let btn = document.getElementById('btn-salvar-ponto');
  if (!btn) {
    btn = document.createElement('button');
    btn.id = "btn-salvar-ponto";
    btn.textContent = "💾 Salvar ponto";
    btn.style.position = "absolute";
    btn.style.left = "18px";
    btn.style.bottom = "18px";
    btn.style.background = "#1db954";
    btn.style.color = "#fff";
    btn.style.border = "none";
    btn.style.padding = "8px 18px";
    btn.style.borderRadius = "24px";
    btn.style.cursor = "pointer";
    btn.style.zIndex = "20000";
    btn.style.display = "none";
    modalDiv.appendChild(btn);
  }
})();

const btnSalvarPonto = document.getElementById('btn-salvar-ponto');

// Modifique abrirModalPlayer para aceitar tempo inicial
function abrirModalPlayer(link, infoEpisodio = null, tempoInicial = null) {
  let usuario = localStorage.getItem('usuarioLogado');
  let idVideo = link.split('?')[0];
  let tempoSalvo = tempoInicial != null ? tempoInicial : (usuario ? obterTempoAssistido(usuario, idVideo) : 0);

  // Adiciona ?start=tempo na URL do Google Drive se houver tempo salvo
  let url = link;
  if (tempoSalvo > 0) {
    url += (url.includes('?') ? '&' : '?') + 'start=' + Math.floor(tempoSalvo);
  }
  iframePlayer.src = url;
  modalPlayer.classList.add("show");
  modalPlayer.focus();
  episodioAtualInfo = infoEpisodio;
  document.body.classList.add('modal-aberto');
  const metaViewport = document.getElementById('meta-viewport');
  if (metaViewport) {
    metaViewport.setAttribute('content', 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no');
  }
  // Exibe botão pular capítulo ou próxima temporada
  if (infoEpisodio && infoEpisodio.tipo === 'serie') {
    const serie = infoEpisodio.serie;
    const numTemp = infoEpisodio.temporada;
    const numEpi = infoEpisodio.episodio;
    const temporada = serie.temporadas.find(t => t.numero === numTemp);
    const proxTemp = serie.temporadas.find(t => t.numero === numTemp + 1);
    const ehUltimoEpi = numEpi === temporada.episodios.length;
    const temProximoEpi = numEpi < temporada.episodios.length;
    const temProximaTemporada = proxTemp && proxTemp.episodios.length > 0;

    if (temProximoEpi) {
      btnPularCapitulo.textContent = '⏭️ Pular Episódio';
      btnPularCapitulo.style.display = 'inline-block';
      btnPularCapitulo.disabled = false;
    } else if (ehUltimoEpi && temProximaTemporada) {
      btnPularCapitulo.textContent = '⏭️ Próxima Temporada';
      btnPularCapitulo.style.display = 'inline-block';
      btnPularCapitulo.disabled = false;
    } else {
      btnPularCapitulo.style.display = 'none';
    }
    btnPularCapitulo.style.position = 'absolute';
    btnPularCapitulo.style.bottom = '18px';
    btnPularCapitulo.style.right = '18px';
    btnPularCapitulo.style.left = 'auto';
    btnPularCapitulo.style.top = '';
    btnPularCapitulo.style.zIndex = '20000';
    btnPularCapitulo.style.visibility = 'visible';
    btnPularCapitulo.style.opacity = '1';
  } else {
    btnPularCapitulo.style.display = 'none';
  }

  // Exibe botão salvar ponto
  btnSalvarPonto.style.display = 'inline-block';
  btnSalvarPonto.onclick = function() {
    mostrarPopupSalvarTempo();
  };
}

// Função para mostrar popup de salvar tempo
function mostrarPopupSalvarTempo() {
  // Remove popup antigo se existir
  let antigo = document.getElementById('popup-salvar-tempo');
  if (antigo) antigo.remove();

  // Cria o overlay
  const overlay = document.createElement('div');
  overlay.id = 'popup-salvar-tempo';
  overlay.style.position = 'fixed';
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = '100vw';
  overlay.style.height = '100vh';
  overlay.style.background = 'rgba(0,0,0,0.45)';
  overlay.style.display = 'flex';
  overlay.style.alignItems = 'center';
  overlay.style.justifyContent = 'center';
  overlay.style.zIndex = 999999;

  // Cria o conteúdo do popup
  const box = document.createElement('div');
  box.style.background = '#222';
  box.style.color = '#fff';
  box.style.padding = '32px 24px 24px 24px';
  box.style.borderRadius = '18px';
  box.style.boxShadow = '0 8px 32px #000a';
  box.style.textAlign = 'center';
  box.style.position = 'relative';
  box.style.maxWidth = '90vw';
  box.style.minWidth = '260px';
  box.innerHTML = `
    <h2 style="margin-top:0;font-size:1.3rem;">💾 Salvar ponto</h2>
    <div style="margin-bottom:14px;font-size:1rem;">Informe o tempo para continuar depois:</div>
    <div style="display:flex;gap:8px;justify-content:center;margin-bottom:18px;">
      <input id="input-horas" type="number" min="0" max="99" placeholder="Horas" style="width:60px;padding:8px;border-radius:8px;border:none;font-size:1rem;background:#111;color:#fff;">
      <input id="input-minutos" type="number" min="0" max="59" placeholder="Min" style="width:60px;padding:8px;border-radius:8px;border:none;font-size:1rem;background:#111;color:#fff;">
      <input id="input-segundos" type="number" min="0" max="59" placeholder="Seg" style="width:60px;padding:8px;border-radius:8px;border:none;font-size:1rem;background:#111;color:#fff;">
    </div>
    <button id="btn-confirmar-salvar-tempo" style="background:#1db954;color:#fff;border:none;padding:10px 22px;border-radius:8px;font-size:1rem;cursor:pointer;">Salvar</button>
    <button id="btn-cancelar-salvar-tempo" style="margin-left:10px;background:#e50914;color:#fff;border:none;padding:10px 22px;border-radius:8px;font-size:1rem;cursor:pointer;">Cancelar</button>
    <div id="msg-erro-tempo" style="color:#e50914;font-size:1rem;margin-top:10px;display:none;"></div>
  `;

  overlay.appendChild(box);
  document.body.appendChild(overlay);

  // Foco no primeiro campo
  setTimeout(() => { document.getElementById('input-horas').focus(); }, 200);

  // Cancelar
  document.getElementById('btn-cancelar-salvar-tempo').onclick = function() {
    overlay.remove();
  };

  // Fechar ao clicar fora do box
  overlay.onclick = function(e) {
    if (e.target === overlay) overlay.remove();
  };

  // Salvar
  document.getElementById('btn-confirmar-salvar-tempo').onclick = function() {
    let horas = parseInt(document.getElementById('input-horas').value, 10);
    let min = parseInt(document.getElementById('input-minutos').value, 10);
    let seg = parseInt(document.getElementById('input-segundos').value, 10);
    if (isNaN(horas)) horas = 0;
    if (isNaN(min)) min = 0;
    if (isNaN(seg)) seg = 0;
    if (horas < 0) horas = 0;
    if (min < 0) min = 0;
    if (seg < 0) seg = 0;
    const tempoTotal = horas * 3600 + min * 60 + seg;
    if (tempoTotal <= 0) {
      document.getElementById('msg-erro-tempo').textContent = "Informe um tempo válido!";
      document.getElementById('msg-erro-tempo').style.display = "block";
      return;
    }
    // Chama o mesmo código do seu btnSalvarPonto original
    btnSalvarPonto._salvarTempo(tempoTotal);
    overlay.remove();
  };
}

// Adicione este método ao botão para reaproveitar seu código original
btnSalvarPonto._salvarTempo = function(tempoTotal) {
  let usuario = localStorage.getItem('usuarioLogado');
  let link = iframePlayer.src.split('?')[0];
  let idVideo = link;
  let info = {};
  let infoEpisodio = window.episodioAtualInfo;
  let isTrailer = false;
  let filmeOuSerie = null;
  function tituloValido(t) {
    return t && !/^https?:\/+/.test(t);
  }
  function imagemValida(img) {
    if (!img) return false;
    img = img.trim();
    return /^imagens\/.+\.(jpg|jpeg|png|webp)$/i.test(img);
  }
  function normalizar(s) {
    return s ? s.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^\w]/g, '').toLowerCase() : '';
  }
  if (link && link.includes("youtube.com")) {
    filmeOuSerie = (typeof dados !== "undefined" ? dados : []).find(f =>
      f.trailer && (f.trailer === link || f.trailer.split('?')[0] === link.split('?')[0])
    );
    isTrailer = true;
  } else if (infoEpisodio && (infoEpisodio.tipo === 'series' || infoEpisodio.tipo === 'serie')) {
    let serieTitulo = infoEpisodio.serie && infoEpisodio.serie.titulo ? infoEpisodio.serie.titulo : '';
    let serieDados = null;
    if (serieTitulo && typeof dados !== 'undefined') {
      serieDados = dados.find(f => (f.tipo === 'series' || f.tipo === 'serie') && normalizar(f.titulo) === normalizar(serieTitulo));
    }
    if (!serieDados && serieTitulo && typeof dados !== 'undefined') {
      serieDados = dados.find(f => normalizar(f.titulo) === normalizar(serieTitulo));
    }
    if (serieDados && imagemValida(serieDados.imagem)) {
      let imagem = serieDados.imagem;
      let titulo = tituloValido(serieDados.titulo) ? serieDados.titulo : (serieTitulo || 'Série');
      let temporada = infoEpisodio.temporada || '';
      let episodio = infoEpisodio.episodio || '';
      // Garante que todos os campos necessários estão presentes
      info = {
        tipo: 'series',
        imagem: imagem || '',
        titulo: titulo || '',
        temporada: temporada || '',
        episodio: episodio || '',
        video: link
      };
    } else {
      return;
    }
  } else {
    filmeOuSerie = (typeof dados !== "undefined" ? dados : []).find(f =>
      f.video && (f.video === link || f.video.split('?')[0] === link.split('?')[0])
    );
    if (filmeOuSerie) {
      if (imagemValida(filmeOuSerie.imagem)) {
        let imagem = filmeOuSerie.imagem;
        let titulo = tituloValido(filmeOuSerie.titulo) ? filmeOuSerie.titulo : 'Filme';
        info = {
          titulo,
          imagem,
          video: link,
          tipo: filmeOuSerie.tipo,
          ano: filmeOuSerie.ano || "",
          descricao: filmeOuSerie.descricao || ""
        };
      } else {
        return;
      }
    } else {
      return;
    }
  }
  if (isTrailer && filmeOuSerie) {
    if (imagemValida(filmeOuSerie.imagem)) {
      info = {
        titulo: tituloValido(filmeOuSerie.titulo) ? `Trailer: ${filmeOuSerie.titulo}` : 'Trailer',
        imagem: filmeOuSerie.imagem,
        video: link,
        tipo: 'trailer',
        ano: filmeOuSerie.ano || "",
        descricao: filmeOuSerie.descricao || ""
      };
    } else {
      return;
    }
  }
  // Garante que info sempre tem todos os campos necessários
  if (!info.titulo) info.titulo = 'Conteúdo';
  if (!info.imagem) info.imagem = imagem;
  if (!info.video) info.video = link;
  if (!info.tipo) info.tipo = 'conteudo';
  salvarTempoAssistido(usuario, idVideo, tempoTotal, info);
  renderizarContinuarAssistindo();
  // Popup de sucesso
  let antigo = document.getElementById('popup-salvo-ponto');
  if (antigo) antigo.remove();
  const overlay = document.createElement('div');
  overlay.id = 'popup-salvo-ponto';
  overlay.style.position = 'fixed';
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = '100vw';
  overlay.style.height = '100vh';
  overlay.style.background = 'rgba(0,0,0,0.35)';
  overlay.style.display = 'flex';
  overlay.style.alignItems = 'center';
  overlay.style.justifyContent = 'center';
  overlay.style.zIndex = 999999;
  const box = document.createElement('div');
  box.style.background = '#222';
  box.style.color = '#fff';
  box.style.padding = '32px 24px 24px 24px';
  box.style.borderRadius = '18px';
  box.style.boxShadow = '0 8px 32px #000a';
  box.style.textAlign = 'center';
  box.style.position = 'relative';
  box.style.maxWidth = '90vw';
  box.style.minWidth = '240px';
  box.innerHTML = `
    <div style="font-size:2.2rem;margin-bottom:10px;">💾</div>
    <h2 style="margin-top:0;font-size:1.3rem;">Ponto salvo com sucesso!</h2>
    <div style="font-size:1rem;color:#1db954;margin-bottom:10px;">Você pode continuar de onde parou.</div>
    <button id="btn-fechar-ponto" style="margin-top:10px;padding:8px 22px;font-size:1rem;border:none;border-radius:8px;background:#1db954;color:#fff;cursor:pointer;">OK</button>
  `;
  overlay.appendChild(box);
  document.body.appendChild(overlay);
  document.getElementById('btn-fechar-ponto').onclick = function() {
    overlay.remove();
  };
  overlay.onclick = function(e) {
    if (e.target === overlay) overlay.remove();
  };
};

// Corrige o botão "Limpar Histórico"
document.getElementById('btn-limpar-historico').onclick = function() {
  mostrarPopupConfirmarLimparHistorico();
};

function mostrarPopupConfirmarLimparHistorico() {
  let antigo = document.getElementById('popup-confirmar-limpar');
  if (antigo) antigo.remove();

  const overlay = document.createElement('div');
  overlay.id = 'popup-confirmar-limpar';
  overlay.style.position = 'fixed';
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = '100vw';
  overlay.style.height = '100vh';
  overlay.style.background = 'rgba(0,0,0,0.45)';
  overlay.style.display = 'flex';
  overlay.style.alignItems = 'center';
  overlay.style.justifyContent = 'center';
  overlay.style.zIndex = 999999;

  const box = document.createElement('div');
  box.style.background = '#222';
  box.style.color = '#fff';
  box.style.padding = '32px 24px 24px 24px';
  box.style.borderRadius = '18px';
  box.style.boxShadow = '0 8px 32px #000a';
  box.style.textAlign = 'center';
  box.style.position = 'relative';
  box.style.maxWidth = '90vw';
  box.style.minWidth = '260px';
  box.innerHTML = `
    <h2 style="margin-top:0;font-size:1.3rem;">Limpar histórico?</h2>
    <div style="margin-bottom:14px;font-size:1rem;">Tem certeza que deseja apagar todo o histórico de continuar assistindo?</div>
    <button id="btn-confirmar-limpar" style="background:#e50914;color:#fff;border:none;padding:10px 22px;border-radius:8px;font-size:1rem;cursor:pointer;">Sim, apagar</button>
    <button id="btn-cancelar-limpar" style="margin-left:10px;background:#444;color:#fff;border:none;padding:10px 22px;border-radius:8px;font-size:1rem;cursor:pointer;">Cancelar</button>
  `;

  overlay.appendChild(box);
  document.body.appendChild(overlay);

  document.getElementById('btn-cancelar-limpar').onclick = function() {
    overlay.remove();
  };

  document.getElementById('btn-confirmar-limpar').onclick = function() {
    const usuario = localStorage.getItem('usuarioLogado');
    if (!usuario) return;
    const prefix = `visto_${usuario}_`;


    const chavesParaRemover = [];
    for (let i = 0; i < localStorage.length; i++) {
      const k = localStorage.key(i);
      if (k.startsWith(prefix)) chavesParaRemover.push(k);
    }
    chavesParaRemover.forEach(k => localStorage.removeItem(k));
    renderizarContinuarAssistindo();
    overlay.remove();
  };

  overlay.onclick = function(e) {
    if (e.target === overlay) overlay.remove();
  };
}

function mostrarPopupPix() {
  let antigo = document.getElementById('popup-pix');
  if (antigo) antigo.remove();

  const overlay = document.createElement('div');
  overlay.id = 'popup-pix';
  overlay.style.position = 'fixed';
  overlay.style.top = 0;
  overlay.style.left = 0;
  overlay.style.width = '100vw';
  overlay.style.height = '100vh';
  overlay.style.background = 'rgba(0,0,0,0.45)';
  overlay.style.display = 'flex';
  overlay.style.alignItems = 'center';
  overlay.style.justifyContent = 'center';
  overlay.style.zIndex = 999999;

  const box = document.createElement('div');
  box.style.background = '#222';
  box.style.color = '#fff';
  box.style.padding = '32px 24px 24px 24px';
  box.style.borderRadius = '18px';
  box.style.boxShadow = '0 8px 32px #000a';
  box.style.textAlign = 'center';
  box.style.position = 'relative';
  box.style.maxWidth = '90vw';
  box.style.minWidth = '260px';
  box.innerHTML = `
    <h2 style="margin-top:0;font-size:1.5rem;">💸 Apoie o KzFlix!</h2>
    <p style="font-size:1.1rem;margin-bottom:18px;">Chave PIX:</p>
    <div style="background:#111;padding:12px 10px;border-radius:8px;font-size:1.1rem;letter-spacing:1px;user-select:all;word-break:break-all;margin-bottom:12px;">
      <b id="pix-chave" style="font-size:1.15rem;">pixkzinn@gmail.com</b>
      <button id="btn-copiar-pix" style="margin-left:10px;padding:4px 10px;font-size:1rem;border:none;border-radius:6px;background:#1db954;color:#fff;cursor:pointer;">Copiar</button>
    </div>
    <div style="font-size:1rem;color:#1db954;margin-bottom:10px;">Muito obrigado pelo apoio! 🙏</div>
    <button id="btn-fechar-pix" style="margin-top:10px;padding:8px 22px;font-size:1rem;border:none;border-radius:8px;background:#e50914;color:#fff;cursor:pointer;">Fechar</button>
  `;

  overlay.appendChild(box);
  document.body.appendChild(overlay);

  document.getElementById('btn-fechar-pix').onclick = function() {
    overlay.remove();
  };
  document.getElementById('btn-copiar-pix').onclick = function() {
    const chave = document.getElementById('pix-chave').textContent;
    navigator.clipboard.writeText(chave);
    this.textContent = 'Copiado!';
    setTimeout(() => { this.textContent = 'Copiar'; }, 1500);
  };
  overlay.onclick = function(e) {
    if (e.target === overlay) overlay.remove();
  };
}
</script>
</div>
</body>
</html>
